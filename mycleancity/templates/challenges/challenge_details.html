{% extends '_public_base.html' %}

{% block title %} My Clean City - {{ challenge.title }} {% endblock %}

{% block css %}
  <link href="{{ STATIC_URL }}css/mycleancity.css" rel="stylesheet">
{% endblock %}

{% block content %}

<div class="wrapper public">
  <div class="clouds"></div>

  {% if user.is_authenticated %}
    {% include "_loggedin_navbar.html" %}
  {% else %}
    {% include "_public_navbar.html" %}
  {% endif %}

  <a href="/" class="logo"></a>
  
  <div class="content challenge-overview">
    <div class="container">
    	<div id="sign-challenge-overview"></div>
        <div id="white-box">
          {% if challenge.national_challenge %}
            <img class="badge-icon" src="{{ STATIC_URL }}images/badge-nc-88x64.png" alt="National Challenge" />
          {% endif %}
        	<h1 class="bold">{{ challenge.title }}</h1>
          <div class="clear"></div>
            
          {% if error %}
            <div class="message-box error">
             <p>{{ error }}</p>
            </div>
          {% endif %}

          <div class="clear"></div>
          {% if challenge.clean_team_only %}
            <span class="clean-team-only bold"><h2>Clean Teams Only</h2></span>
          {% endif %}
        	<div class="clear"></div>

        	{% if user.profile.is_clean_ambassador and user.profile.clean_team_member.clean_team.id == challenge.clean_team.id %}
        	<span id="edit-challenge-link">
        		<a href="/challenges/edit/{{ challenge.id }}/">Edit Action</a>
        	</span>
        	{% endif %}
        	<div class="clear"></div>
        	
  			<table>
          {% if challenge.host_organization %}
            <tr>
              <td><span class="titles">Hosted by: {{ challenge.host_organization }}</span></td>
            </tr>
          {% endif %}
          <tr>
            <td colspan="2"><span class="titles">Created by:</span> <span class="bold"><a href="/clean-team/{{ challenge.clean_team.id }}">{{ challenge.clean_team.name }}</a></span></td>
          </tr>
          {% if challenge.contact_first_name %}
          <tr>
            <td colspan="2"><span class="titles">Main Contact:</span> <span class="bold">
              <a class="popup-600" href="#challenge-description">{{ challenge.contact_first_name }} {{ challenge.contact_last_name }}</a></span></td>
          </tr>
          {% endif %}
  				<tr>
  					<td colspan="2"><span class="titles">Date and time:</span> {{ challenge.event_start_date }} {{ challenge.event_start_time }} until {{ challenge.event_end_date }} {{ challenge.event_end_time }}</td>
          </tr>
          
  				<tr>
  					<td colspan="2"><span class="titles">Location:</span> {{ challenge.address1 }} {{ challenge.address2 }} {{ challenge.city }}, {{ challenge.province }} {{ challenge.postal_code }} {{ challenge.country }}</td>
  				</tr>
          
          {% if challenge.link %}
          <tr>
            <td colspan="2"><a href="{{ challenge.link }}" target="_blank">External Link</a></td>
          </tr>
          {% endif %}

  				<tr>
  					<td><h2 class="clean-creds-per-hour">{{ challenge.clean_creds_per_hour }}&nbsp;<span class="green bold">Change</span><span class="blue bold">Creds</span><span>{% if challenge.type.challenge_type == "hourly" %}/hr{% endif %}</span></h2></td>
            <td><div class="fb-like" data-href="http://www.mycleancity.org{{ page_url }}" data-width="450" data-layout="button_count" data-show-faces="true" data-send="false"></div>
        
        <a href="http://www.mycleancity.org{{ page_url }}" class="twitter-share-button">Tweet</a></td>
  				</tr>
          <tr>
            <td colspan="2">
              <p>{{ challenge.description|slice:":130" }}...</p>
              <a id="learn-more" class="popup-600" href="#challenge-description">Learn more</a>
            </td>
          </tr>
  			</table>
  		    
        <div class="clear"></div>

  			{% if user.is_authenticated %}
          {% if challenge.clean_team_only %}
    				{% if user.profile.is_clean_ambassador %}
              {% if user_challenge %}
                {% if participating_store %}
                  <h2>Participating with</h2>
                  <div class="clear"></div>
                  <p>Store {{ participating_store.staples_store.store_no }} - {{ participating_store.staples_store.store_name }}
                    <br>
                  {{ participating_store.staples_store.address }} {{ participating_store.staples_store.city }}
                  </p>
                {% endif %}
                {% if can_unparticipate %}
                  <form action="/challenges/unparticipate/" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="cid" value="{{ challenge.id }}">
                    <input id="participate-btn" class="btn btn-primary" type="submit" value="Unparticipate" />
                  </form>
                {% else %}
                  <input id="participate-btn" disabled class="btn btn-primary" type="submit" value="Participating" />
                {% endif %}                
              {% else %}
                <form action="/challenges/participate/" method="post">
                  {% csrf_token %}
                  <input type="hidden" name="cid" value="{{ challenge.id }}">

                  {% if challenge.url == "staples-cleanact" %}
                    <label id="staples-stores-label" for="staples_store">Select an available Staples store below:</label>
                    <div class="clear"></div>
                    <select name="staples_store" id="staples-stores-selection">
                    {% for store in staples_stores %}
                      <option value="{{ store.id }}">Store No: {{ store.store_no }}&nbsp;at&nbsp;{{ store.store_name }}</option>
                    {% endfor %}
                    </select>
                  {% endif %}

                  <input id="participate-btn" class="btn btn-primary" type="submit" value="Participate with your Clean Team" />
                </form>
              {% endif %}
            {% else %}
              <a id="participate-btn" class="btn btn-primary btn-block" href="/clean-team/create-or-request/">Create Clean Team</a>
            {% endif %}
          {% else %}
            {% if user_challenge %}
              {% if can_unparticipate %}
                <form action="/challenges/unparticipate/" method="post">
                  {% csrf_token %}
                  <input type="hidden" name="cid" value="{{ challenge.id }}">
                  <input id="participate-btn" class="btn btn-primary" type="submit" value="Unparticipate" />
                </form>
              {% else %}
                <input id="participate-btn" disabled class="btn btn-primary" type="submit" value="Participating" />
              {% endif %}
            {% else %}
              <form action="/challenges/participate/" method="post">
                {% csrf_token %}
                <input type="hidden" name="cid" value="{{ challenge.id }}">
                <input id="participate-btn" class="btn btn-primary" type="submit" value="Participate" />
              </form>
            {% endif %}
          {% endif %}
  			{% else %}
  				<a id="participate-btn" class="btn btn-primary btn-block" href="/users/register">Register Now to Participate</a>
  			{% endif %}

      </div><!-- /#white-box -->

      <div id="participants-box">
      	<h1>Participants</h1>

      	<p>Total: {{ count }}</p>

        <ul class="participants-list">
        {% if not challenge.clean_team_only %}
          
    			 {% for participant in participants %}
            <li>
              <a href="/users/profile/{{ participant.user.id }}">
                {% if participant.user.profile.picture %}
                  <img class="profile-pic" src="{{ MEDIA_URL }}{{ participant.user.profile.picture }}" alt="" />
                {% else %}
                  <img class="profile-pic" src="{{ STATIC_URL }}images/default-profile-pic-42x42.png" alt="" />
                {% endif %}
                <span>{{ participant.user.get_full_name }}</span>
              </a>
            </li>
           {% endfor %}
        {% else %}
           {% for participant in participants %}
            <li>
              <a href="/clean-team/{{ participant.clean_team.id }}">
                {% if participant.clean_team.logo %}
                  <img class="profile-pic" src="{{ MEDIA_URL }}{{ participant.clean_team.logo }}" alt="" />
                {% else %}
                  <img class="profile-pic" src="{{ STATIC_URL }}images/default-team-pic-42x42.png" alt="" />
                {% endif %}
                <span>{{ participant.clean_team.name }}</span>
              </a>
            </li>
           {% endfor %}
        {% endif %}
        </ul>
      </div>
    </div><!-- /.container -->

    <div class="popup-container">
      <div id="challenge-description" class="popup">
        <p>{{ challenge.description }}</p>
        <div id="main-contact-container">
          <h2>Main Contact</h2>
          <table class="table">
            <tr>
              <td><span class="titles">Name:</span> <span class="bold">
                {{ challenge.contact_first_name }} {{ challenge.contact_last_name }}
              </td>
            </tr>
            <tr>
              <td><span class="titles">Email address:</span> <span class="bold">
                <a href="mailto:{{ challenge.clean_team.contact_user.email }}">{{ challenge.contact_email }}</a>
              </td>
            </tr>
            <tr>
              <td><span class="titles">Phone number:</span> <span class="bold">
                {{ challenge.contact_phone }}
              </td>
            </tr>
          </table>
        </div><!-- end of .main-contact -->
      </div><!-- end of #challenge-description -->
    </div><!-- end of .popup-container -->  

  </div><!-- /.challenge-overview -->
</div> <!-- /.wrapper -->


{% include "_footer_navbar.html" %}

{% endblock %}

{% block javascript %}{% endblock %}